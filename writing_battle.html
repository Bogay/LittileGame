<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº”è¡Œå¯«å­—å¤§æˆ°ï¼šGoogle Cloud Vision API ç‰ˆ</title>
    
    <script src="https://cdn.jsdelivr.net/npm/cnchar/cnchar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cnchar-radical/cnchar.radical.min.js"></script>
    
    <style>
        :root {
            --metal: #b0bec5; --wood: #66bb6a; --water: #42a5f5;
            --fire: #ef5350; --earth: #8d6e63; --bg: #263238;
        }
        body {
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg); color: white; margin: 0; padding: 0;
            height: 100vh; display: flex; flex-direction: column; align-items: center;
            overflow: hidden; user-select: none; touch-action: none;
        }

        .cycle-bar {
            background: rgba(0,0,0,0.6); padding: 8px 15px; border-radius: 20px;
            margin-top: 10px; font-size: 14px; color: #ddd; display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;
            border: 1px solid #555; width: 95%;
        }
        .cycle-item b { color: #ffeb3b; }

        .top-bar {
            width: 100%; padding: 5px 20px;
            display: flex; justify-content: space-between; align-items: center;
            box-sizing: border-box; font-size: 18px; font-weight: bold;
        }

        .battle-stage {
            flex: 1; width: 100%; max-width: 600px; position: relative;
            display: flex; justify-content: space-around; align-items: center;
        }
        .fighter {
            display: flex; flex-direction: column; align-items: center;
            width: 130px; position: relative; transition: transform 0.2s;
        }
        .fighter-avatar { font-size: 80px; filter: drop-shadow(0 0 15px rgba(255,255,255,0.1)); }
        .hp-bar-box { width: 100%; height: 12px; background: #444; border-radius: 6px; overflow: hidden; margin-top: 5px; border: 2px solid #fff;}
        .hp-bar { height: 100%; background: #4caf50; width: 100%; transition: width 0.3s ease-out; }
        .hp-text { font-size: 12px; margin-top: 2px; }
        .fighter-name { font-size: 16px; font-weight: bold; margin-top: 5px; text-shadow: 1px 1px 2px black; }
        
        .attr-icon {
            position: absolute; top: 0; right: 0; width: 36px; height: 36px;
            border-radius: 50%; display: flex; justify-content: center; align-items: center;
            font-size: 18px; font-weight: bold; border: 2px solid white; box-shadow: 0 0 10px black;
            z-index: 10;
        }
        .metal { background: var(--metal); color: #333; }
        .wood { background: var(--wood); color: #fff; }
        .water { background: var(--water); color: #fff; }
        .fire { background: var(--fire); color: #fff; }
        .earth { background: var(--earth); color: #fff; }
        .none { background: #666; color: #ccc; }

        .input-zone {
            width: 100%; max-width: 500px; background: #f5f5f5; border-radius: 25px 25px 0 0;
            padding: 15px; display: flex; flex-direction: column; align-items: center;
            position: relative; padding-bottom: 30px;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.5);
        }
        .timer-bar-container {
            width: 100%; height: 10px; background: #ddd; border-radius: 10px;
            margin-bottom: 10px; overflow: hidden; border: 1px solid #ccc;
        }
        .timer-bar { height: 100%; background: #f44336; width: 100%; }
        
        canvas {
            border: 2px dashed #999; border-radius: 15px; cursor: crosshair;
            background-color: white;
            background-image: linear-gradient(#eee 1px, transparent 1px), linear-gradient(90deg, #eee 1px, transparent 1px);
            background-size: 50px 50px;
            touch-action: none;
        }
        .status-text { color: #333; font-weight: bold; margin-bottom: 8px; min-height: 24px; font-size: 18px; }

        #fallback-input-area {
            display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 20px; border-radius: 15px; text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); z-index: 50; border: 4px solid #ff9800;
        }
        #manual-input { font-size: 28px; width: 100px; text-align: center; padding: 8px; margin: 10px 0; border: 2px solid #aaa; border-radius: 5px; }

        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200; display: flex;
            flex-direction: column; justify-content: center; align-items: center;
            color: white; text-align: center; padding: 20px;
        }
        .btn-start {
            padding: 15px 50px; font-size: 24px; background: #ff9800; color: white;
            border: none; border-radius: 50px; margin-top: 30px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(255,152,0,0.4);
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse { 0%{transform:scale(1);} 50%{transform:scale(1.05);} 100%{transform:scale(1);} }

        .dmg-float {
            position: absolute; font-size: 50px; font-weight: 900;
            color: #ffeb3b; text-shadow: 3px 3px 0 #d32f2f;
            animation: floatUp 1s forwards; pointer-events: none; z-index: 100;
        }
        @keyframes floatUp { to { transform: translateY(-120px) scale(1.2); opacity: 0; } }
    </style>
</head>
<body>

    <div class="overlay" id="overlay">
        <h1 style="margin-bottom: 10px;">ğŸ”¥ äº”è¡Œå¯«å­—å¤§æˆ°</h1>
        <p style="font-size: 18px; color: #ccc; line-height: 1.6;">
            å¯«å‡º<b>ç­†ç•«å¤š</b>ä¸”<b>å±¬æ€§ç›¸å‰‹</b>çš„å­—<br>
            âš ï¸ åªæœ‰ 5 ç§’ï¼å¯«å®Œè«‹åœç­†ç­‰å¾…è¾¨è­˜<br>
            <small style="color: #ff9800;">ä½¿ç”¨ Google Cloud Vision API é€²è¡Œè¾¨è­˜</small>
        </p>
        <div style="background: #444; padding: 15px; border-radius: 10px; margin-top: 20px; text-align: left;">
            [æ­£çµ±ç›¸å‰‹]<br>
            âš”ï¸ é‡‘ å‰‹ ğŸŒ² æœ¨<br>
            ğŸŒ² æœ¨ å‰‹ â›°ï¸ åœŸ<br>
            â›°ï¸ åœŸ å‰‹ ğŸ’§ æ°´<br>
            ğŸ’§ æ°´ å‰‹ ğŸ”¥ ç«<br>
            ğŸ”¥ ç« å‰‹ âš”ï¸ é‡‘
        </div>
        <button class="btn-start" onclick="startGame()">é–‹å§‹æŒ‘æˆ°</button>
    </div>

    <div class="cycle-bar">
        <span class="cycle-item">âš”ï¸<b>é‡‘</b>å‰‹ğŸŒ²æœ¨</span> | 
        <span class="cycle-item">ğŸŒ²<b>æœ¨</b>å‰‹â›°ï¸åœŸ</span> | 
        <span class="cycle-item">â›°ï¸<b>åœŸ</b>å‰‹ğŸ’§æ°´</span> | 
        <span class="cycle-item">ğŸ’§<b>æ°´</b>å‰‹ğŸ”¥ç«</span> | 
        <span class="cycle-item">ğŸ”¥<b>ç«</b>å‰‹âš”ï¸é‡‘</span>
    </div>

    <div class="top-bar">
        <span id="stage-num">é—œå¡: 1</span>
        <span id="score">HP: 100</span>
    </div>

    <div class="battle-stage">
        <div class="fighter">
            <div class="attr-icon" id="p-attr">?</div>
            <div class="fighter-avatar">ğŸ§™â€â™‚ï¸</div>
            <div class="hp-bar-box"><div class="hp-bar" id="p-hp"></div></div>
            <div class="hp-text" id="p-hp-text">100/100</div>
        </div>
        
        <div style="font-size:30px; font-weight:900; color:rgba(255,255,255,0.1);">VS</div>

        <div class="fighter">
            <div class="attr-icon" id="e-attr"></div>
            <div class="fighter-avatar" id="e-img">ğŸ‘¹</div>
            <div class="hp-bar-box"><div class="hp-bar" id="e-hp"></div></div>
            <div class="hp-text" id="e-hp-text">100/100</div>
            <div class="fighter-name" id="e-name">æ•µäºº</div>
        </div>
    </div>

    <div class="input-zone">
        <div class="timer-bar-container"><div class="timer-bar" id="timer-bar"></div></div>
        <div class="status-text" id="status-msg">æº–å‚™...</div>
        <canvas id="can" width="320" height="280"></canvas>
        <div style="font-size: 12px; color: #999; margin-top: 5px;">è‹¥æ˜¯è¾¨è­˜å¡ä½ï¼Œè«‹ç¨å€™æˆ–ä½¿ç”¨æ‰‹å‹•è¼¸å…¥</div>

        <div id="fallback-input-area">
            <h3 style="color:#333; margin:0;">è¾¨è­˜å¤±æ•—</h3>
            <p style="color:#666; font-size:14px; margin:5px 0;">è«‹æ‰‹å‹•è¼¸å…¥ï¼š</p>
            <input type="text" id="manual-input" maxlength="1">
            <br><br>
            <button onclick="manualSubmit()" style="font-size:16px; padding:8px 20px; background:#4caf50; color:white; border:none; border-radius:5px; cursor:pointer;">ç¢ºèªæ”»æ“Š</button>
        </div>
    </div>

    <script>
        // âš™ï¸ CONFIGURATION: Set your Google Cloud Vision API Key
        // 
        // To get an API key:
        // 1. Go to https://console.cloud.google.com/
        // 2. Create or select a project
        // 3. Enable the Cloud Vision API
        // 4. Create credentials (API Key)
        // 5. (Optional but recommended) Restrict the API key to your domain
        // 6. Find the line with "const apiKey = 'YOUR_API_KEY';" below (around line 288)
        // 7. Replace 'YOUR_API_KEY' with your actual API key
        //
        // âš ï¸ SECURITY NOTE: 
        // The API key will be visible in the browser's page source.
        // For production use, implement a backend proxy server to protect your API key.
        // Set API key restrictions in Google Cloud Console to limit usage to your domain.
        
        // 1. éŠæˆ²è³‡æ–™
        const ELEMENTS = {
            'metal': { name: 'é‡‘', color: 'metal', icon: 'âš”ï¸', strong: 'wood', weak: 'fire' },
            'wood':  { name: 'æœ¨', color: 'wood',  icon: 'ğŸŒ²', strong: 'earth', weak: 'metal' },
            'earth': { name: 'åœŸ', color: 'earth', icon: 'â›°ï¸', strong: 'water', weak: 'wood' },
            'water': { name: 'æ°´', color: 'water', icon: 'ğŸ’§', strong: 'fire',  weak: 'earth' },
            'fire':  { name: 'ç«', color: 'fire',  icon: 'ğŸ”¥', strong: 'metal', weak: 'water' }
        };

        const RADICALS = {
            'metal': ['é‡‘', 'é’…', 'åˆ€', 'åˆ‚', 'æˆˆ', 'è¾›', 'é…‰', 'ç”³', 'åŒ•', 'çš¿', 'éŒ¢', 'éŠ€', 'éŠ…', 'éµ', 'é‹¼', 'éŒ¯'],
            'wood':  ['æœ¨', 'è‰¹', 'ç«¹', 'ç¦¾', 'ç±³', 'è€’', 'ç“œ', 'æœª', 'è¡£', 'ç³¸', 'æ—', 'æ£®', 'æ¨¹', 'è‰', 'èŠ±'],
            'water': ['æ°´', 'æ°µ', 'é›¨', 'é±¼', 'å†«', 'â„ï¸', 'å·', 'æ³‰', 'é»‘', 'æ±Ÿ', 'æ²³', 'æ¹–', 'æµ·', 'å†°', 'æ·¼'],
            'fire':  ['ç«', 'ç¬', 'æ—¥', 'å…‰', 'èµ¤', 'ä¸™', 'ä¸', 'å¿ƒ', 'å¿„', 'ç‚', 'ç„±', 'ç†±', 'çˆ†', 'çƒ¤'],
            'earth': ['åœŸ', 'å±±', 'çŸ³', 'ç”°', 'é˜œ', 'é˜', 'ç“¦', 'ç©´', 'è¾°', 'ä¸‘', 'æˆŒ', 'æœª', 'åœ°', 'åœ­', 'åš']
        };

        const LEVELS = [
            { attr: 'wood', name: 'æœ½æœ¨å¦–', hp: 100, icon: 'ğŸ§Ÿ' },    
            { attr: 'earth', name: 'å²©çŸ³æ€ª', hp: 150, icon: 'ğŸ—¿' }, 
            { attr: 'water', name: 'æ·±æµ·é¾', hp: 200, icon: 'ğŸ‰' }, 
            { attr: 'fire', name: 'ç‚é­”', hp: 250, icon: 'ğŸ‘º' },    
            { attr: 'metal', name: 'éµç”²è¡›', hp: 300, icon: 'ğŸ¤–' }  
        ];

        let currentLevel = 0;
        let playerHp = 100, maxPlayerHp = 100;
        let enemyHp = 100, maxEnemyHp = 100;
        let isPlayerTurn = false;
        let timerInterval;

        // 2. ç•«å¸ƒè¨­å®š (å›æ­¸ Google API æ ¼å¼: [ [x[], y[], []], ... ])
        const canvas = document.getElementById("can");
        const ctx = canvas.getContext("2d");
        const fallbackArea = document.getElementById('fallback-input-area');
        const manualInput = document.getElementById('manual-input');

        ctx.lineWidth = 10;
        ctx.lineJoin = "round"; ctx.lineCap = "round"; ctx.strokeStyle = "#333";

        let isDown = false;
        let lastPos = {x:0, y:0};
        let traces = []; 
        let currentX = [], currentY = [];

        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            let clientX = e.clientX;
            let clientY = e.clientY;
            if(e.touches && e.touches.length > 0) {
                clientX = e.touches[0].clientX;
                clientY = e.touches[0].clientY;
            }
            return {
                x: Math.round(clientX - rect.left), 
                y: Math.round(clientY - rect.top)
            };
        }

        function startDraw(e) {
            if(!isPlayerTurn) return;
            isDown = true;
            const {x, y} = getPos(e);
            lastPos = {x, y};
            ctx.beginPath(); ctx.moveTo(x, y);
            currentX = [x]; currentY = [y];
        }

        function draw(e) {
            if (!isDown || !isPlayerTurn) return;
            if(e.type === 'touchmove') e.preventDefault();
            const {x, y} = getPos(e);
            ctx.lineTo(x, y); ctx.stroke();
            lastPos = {x, y};
            currentX.push(x); currentY.push(y);
        }

        function endDraw() {
            if(!isDown) return;
            isDown = false;
            if(currentX.length > 0) traces.push([currentX, currentY, []]);
        }

        canvas.addEventListener("mousedown", startDraw); document.addEventListener("mousemove", draw); document.addEventListener("mouseup", endDraw);
        canvas.addEventListener("touchstart", startDraw, {passive:false}); document.addEventListener("touchmove", draw, {passive:false}); document.addEventListener("touchend", endDraw);

        function clearCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            traces = [];
        }

        // 3. è¾¨è­˜æ ¸å¿ƒ (ä½¿ç”¨ Google Cloud Vision API)
        async function recognizeHandwriting() {
            // Convert canvas to base64 image
            const imageBase64 = canvas.toDataURL('image/png').split(',')[1];
            
            // âš ï¸ SECURITY WARNING: This API key is visible in the browser
            // For production use, implement a backend proxy server to protect your API key
            // Replace 'YOUR_API_KEY' with your actual API key
            const apiKey = 'YOUR_API_KEY';
            
            // Check if API key is configured
            if (apiKey === 'YOUR_API_KEY') {
                console.error("API key not configured. Please set your Google Cloud Vision API key.");
                document.getElementById('status-msg').innerText = "âš ï¸ è«‹å…ˆè¨­å®š API é‡‘é‘°";
                document.getElementById('status-msg').style.color = "#ff9800";
                return null;
            }
            
            const visionUrl = `https://vision.googleapis.com/v1/images:annotate?key=${apiKey}`;
            
            const requestBody = {
                "requests": [{
                    "image": {
                        "content": imageBase64
                    },
                    "features": [{
                        "type": "DOCUMENT_TEXT_DETECTION",
                        "maxResults": 1
                    }],
                    "imageContext": {
                        "languageHints": ["zh-TW", "zh"]
                    }
                }]
            };

            try {
                console.log("Sending request to Google Cloud Vision API...");
                const response = await fetch(visionUrl, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(requestBody)
                });
                const json = await response.json();
                
                // Check for errors
                if (json.error) {
                    console.error("Vision API Error:", json.error);
                    document.getElementById('status-msg').innerText = "âŒ API éŒ¯èª¤";
                    document.getElementById('status-msg').style.color = "#f44336";
                    return null;
                }
                
                // Extract text from response
                if (json.responses && json.responses[0] && json.responses[0].textAnnotations && json.responses[0].textAnnotations.length > 0) {
                    const detectedText = json.responses[0].textAnnotations[0].description;
                    // Return first character (in case multiple characters detected)
                    return detectedText.trim().charAt(0);
                }
            } catch (e) {
                console.error("API Error:", e);
                document.getElementById('status-msg').innerText = "âŒ ç¶²è·¯é€£ç·šå¤±æ•—";
                document.getElementById('status-msg').style.color = "#f44336";
            }
            return null;
        }

        // 4. éŠæˆ²é‚è¼¯

        function startGame() {
            document.getElementById('overlay').style.display = 'none';
            currentLevel = 0; playerHp = 100;
            randomizePlayerAttr();
            loadLevel(currentLevel);
        }

        function randomizePlayerAttr() {
            const keys = Object.keys(ELEMENTS);
            const rKey = keys[Math.floor(Math.random() * keys.length)];
            const pAttrDiv = document.getElementById('p-attr');
            pAttrDiv.className = `attr-icon ${ELEMENTS[rKey].color}`;
            pAttrDiv.innerText = ELEMENTS[rKey].name;
        }

        function loadLevel(idx) {
            if (idx >= LEVELS.length) { alert("ğŸ‰ æ­å–œï¼äº”è¡Œå¤§å¸«ï¼"); location.reload(); return; }
            const data = LEVELS[idx];
            enemyHp = data.hp; maxEnemyHp = data.hp;
            
            document.getElementById('stage-num').innerText = `é—œå¡ ${idx+1}`;
            document.getElementById('e-name').innerText = data.name;
            document.getElementById('e-img').innerText = data.icon;
            const el = ELEMENTS[data.attr];
            const eAttrDiv = document.getElementById('e-attr');
            eAttrDiv.className = `attr-icon ${el.color}`; eAttrDiv.innerText = el.name;
            
            updateHpUI();
            startTurn();
        }

        function startTurn() {
            isPlayerTurn = true;
            clearCanvas();
            fallbackArea.style.display = 'none';
            document.getElementById('status-msg').innerText = "5 ç§’å€’æ•¸ï¼Œè«‹å¯«å­—ï¼";
            document.getElementById('status-msg').style.color = "#333";
            
            const bar = document.getElementById('timer-bar');
            bar.style.transition = 'none'; bar.style.width = '100%';
            void bar.offsetWidth; 
            bar.style.transition = 'width 5s linear'; bar.style.width = '0%';

            if(timerInterval) clearTimeout(timerInterval);
            timerInterval = setTimeout(() => {
                if(isPlayerTurn) {
                    isPlayerTurn = false;
                    if(traces.length === 0) handleAttackResult(null, "æ™‚é–“åˆ°ï¼Œæ²’å¯«å­—ï¼");
                    else executeRecognition();
                }
            }, 5000);
        }

        async function executeRecognition() {
            document.getElementById('status-msg').innerText = "è¾¨è­˜ä¸­...";

            // é€™è£¡å°±æ˜¯ä¹‹å‰ç¼ºå°‘çš„å‡½å¼ï¼ç¾åœ¨è£œä¸Šäº†ï¼Œè¶…æ™‚æœƒåˆ‡æ›æ‰‹å‹•è¼¸å…¥
            let failSafe = setTimeout(() => {
                 console.log("Timeout -> Mock");
                 mockRecognition(); 
            }, 3000);

            const char = await recognizeHandwriting();
            clearTimeout(failSafe);

            if (char) {
                handleAttackResult(char);
            } else {
                document.getElementById('status-msg').innerText = "çœ‹ä¸æ‡‚...è«‹è£œæ•‘";
                fallbackArea.style.display = 'block';
                manualInput.value = ''; manualInput.focus();
            }
        }

        // â˜…â˜…â˜… è£œä¸Šéºå¤±çš„å‡½å¼ï¼Œé˜²æ­¢å ±éŒ¯ â˜…â˜…â˜…
        function mockRecognition() {
            document.getElementById('status-msg').innerText = "é€£ç·šä¸ç©©ï¼Œè«‹æ‰‹å‹•è¼¸å…¥";
            fallbackArea.style.display = 'block';
            manualInput.value = ''; 
            manualInput.focus();
        }

        function manualSubmit() {
            let val = manualInput.value.trim();
            if(val) {
                fallbackArea.style.display = 'none';
                handleAttackResult(val);
            }
        }

        function getAttrExact(char) {
            // 1. å„ªå…ˆæª¢æŸ¥å­—æœ¬èº«
            for (let key in RADICALS) {
                if (RADICALS[key].includes(char)) return key;
            }
            // 2. å†æª¢æŸ¥éƒ¨é¦–
            if (typeof cnchar !== 'undefined' && cnchar.radical) {
                let radical = cnchar.radical(char);
                for (let key in RADICALS) {
                    if (RADICALS[key].includes(radical)) return key;
                }
            }
            return 'none';
        }

        function handleAttackResult(char, errorMsg) {
            if (!char) {
                document.getElementById('status-msg').innerText = errorMsg || "æ”»æ“Šå¤±æ•—ï¼";
                document.getElementById('status-msg').style.color = "red";
                setTimeout(enemyTurn, 1500);
                return;
            }

            let strokesNum = 0;
            if(typeof cnchar !== 'undefined') strokesNum = cnchar.stroke(char);

            let attr = getAttrExact(char);
            let enemyAttr = LEVELS[currentLevel].attr;

            let attrName = (attr === 'none') ? 'ç„¡' : ELEMENTS[attr].name;
            document.getElementById('status-msg').innerText = `ã€${char}ã€‘${strokesNum}ç•« (${attrName}å±¬æ€§)`;
            
            const pAttrDiv = document.getElementById('p-attr');
            pAttrDiv.style.display = 'flex';
            if (attr !== 'none') {
                pAttrDiv.className = `attr-icon ${ELEMENTS[attr].color}`;
                pAttrDiv.innerText = ELEMENTS[attr].name;
            } else {
                pAttrDiv.className = `attr-icon none`;
                pAttrDiv.style.background = '#999';
                pAttrDiv.innerText = '?';
            }

            let multiplier = 1.0;
            if (attr !== 'none') {
                if (ELEMENTS[attr].strong === enemyAttr) multiplier = 2.0; // å‰‹åˆ¶
                else if (ELEMENTS[attr].weak === enemyAttr) multiplier = 0.5; // è¢«å‰‹
            } else {
                multiplier = 0.8;
            }

            let damage = Math.ceil(strokesNum * 5 * multiplier);
            
            setTimeout(() => {
                enemyHp -= damage;
                updateHpUI();
                showDamage(damage, multiplier, true);
                
                if (enemyHp <= 0) {
                    setTimeout(() => {
                        alert(`ğŸ‰ å‹åˆ©ï¼æ“Šæ•— ${LEVELS[currentLevel].name}ï¼`);
                        currentLevel++;
                        loadLevel(currentLevel);
                    }, 1000);
                } else {
                    setTimeout(enemyTurn, 1500);
                }
            }, 500);
        }

        function enemyTurn() {
            document.getElementById('status-msg').innerText = "æ•µäººæ”»æ“Šä¸­...";
            let dmg = 15 + Math.floor(Math.random() * 10);
            playerHp -= dmg;
            updateHpUI();
            
            document.body.style.transform = "translate(5px, 5px)";
            setTimeout(() => document.body.style.transform = "translate(0,0)", 100);
            showDamage(dmg, 1.0, false);

            if(playerHp <= 0) {
                alert("ğŸ’€ ä½ è¼¸äº†... è«‹é‡æ–°æŒ‘æˆ°ï¼");
                startGame();
            } else {
                setTimeout(startTurn, 1500);
            }
        }

        function updateHpUI() {
            let ep = Math.max(0, (enemyHp / maxEnemyHp) * 100);
            let pp = Math.max(0, (playerHp / maxPlayerHp) * 100);
            document.getElementById('e-hp').style.width = ep + "%";
            document.getElementById('p-hp').style.width = pp + "%";
            document.getElementById('p-hp-text').innerText = `${Math.max(0,playerHp)}/${maxPlayerHp}`;
            document.getElementById('e-hp-text').innerText = `${Math.max(0,enemyHp)}/${maxEnemyHp}`;
        }

        function showDamage(val, mult, isEnemyHurt) {
            const el = document.createElement('div');
            el.className = 'dmg-float';
            let prefix = "";
            if(mult >= 2.0) { prefix = "æ•ˆæœçµ•ä½³! "; el.style.color = "#ff5252"; el.style.fontSize = "55px"; }
            else if(mult <= 0.5) { prefix = "æ•ˆæœä¸å¥½.. "; el.style.color = "#ccc"; el.style.fontSize = "30px"; }
            else { el.style.color = "yellow"; }
            el.innerText = `${prefix}${val}`;
            
            if(isEnemyHurt) { el.style.top = "20%"; el.style.right = "20%"; } 
            else { el.style.top = "20%"; el.style.left = "20%"; el.style.color = "red"; }
            document.body.appendChild(el);
            setTimeout(()=>el.remove(), 1000);
        }
    </script>
</body>
</html>
